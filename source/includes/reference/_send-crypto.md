# send-crypto #

A request from Simplex for you to send cryptocurrency to a specified destination crypto address.

If you are the entity providing liquidity for a Simplex transaction, then after Simplex approves the transaction you will be asked to create a blockchain transaction that will result in the transfer of a specified amount of cryptocurrency to a specified destination crypto address.

In case of a refund, if you are the entity that received the cryptocurrency you will be asked to send it back (albeit to a possibly different crypto address from which it was sent).

This request from Simplex results in you creating an "execution order" process, which on your end is responsible for generating the blockchain transaction.

Your response includes an identifier for this execution order, which Simplex can use to query you about its status.

The status of an execution order may be:

 * `"pending"` : you haven't yet created the blockchain transaction, but are in the process of doing so.

 * `"completed"` : you fulfilled the execution order by creating a blockchain transaction.

 * `"failed"` : there was an error creating the blockchain transaction.

## Synopsis ##

API name: **`send-crypto`**  
Direction: **Simplex &rarr; You**

## Parameters ##

> Example request:

```json
{
  "reason": "delivery",
  "txn_id": "af492cb2-5b07-4318-8ece-be34f479e23b",
  "user_id": "595b88bea687c5dd444f99e0004a45d3",
  "user_aka_ids": ["1504241c7d83476aa3adcd54e2272d25", "38b583c7ccd246ffaed4ab0232b71647"],
  "account_id": "39cb996a-6cc8-43b9-ad37-1102a958ff38",
  "quote_id": "bb4fbdef-9abc-41c1-94d9-a670413c4d02",
  "crypto_currency": "BTC",
  "crypto_amount": 125000, // 0.125 BTC
  "destination_crypto_address": "1GzW2M6L54DGMUUv2DTrdPTt8PX6ck5SYp"
}
```

Name                       | Type           |   |
-------------------------- | -------------- | - |
reason                     | String         | **required**
txn_id                     | Id             | **required**
user_id                    | Id             | **required**
user_aka_ids               | List<Id>       | **required**
account_id                 | Id             |
quote_id                   | Id             | **required**
crypto_currency            | CryptoCurrency | **required**
crypto_amount              | MoneyAmount    | **required**
destination_crypto_address | CryptoAddress  | **required**

### reason ###
#### (String, **required**)

The reason you are sending cryptocurrency.

One of { `"delivery"`, `"refund"` }.

 * `"delivery"` : you are selling cryptocurrency: you are either the Liquidity Provider (in a BuyCrypto transaction) or the App (in a SellCrypto transaction)

 * `"refund"` : the reverse of "delivery" -- we need to return, to the original sender, cryptocurrency that you previously received.

### txn_id ###
#### (Id, **required**)

The identifier of the Simplex transaction involved.

### user_id ###
#### (Id, **required**)

A unique identifier, created by Simplex, for the end-user performing the transaction.

Same `user_id` as a previous message means same end-user.

### user_aka_ids ###
#### (List<Id>, **required**)

A list of unique identifiers, on top of `user_id`, by which the user is also known.

### account_id ###
#### (Id, optional)

For wallets/exchanges: the end-user's account id on your system. This is what you sent Simplex in `initiate-sell`.

### quote_id ###
#### (Id, **required**)

The identifier of the quote on which this transaction is based.

### crypto_currency ###
#### (CryptoCurrency, **required**)

The crypto currency (the currency, not the amount) to send.

### crypto_amount ###
#### (MoneyAmount, **required**)

How much cryptocurrency of type `crypto_currency` to send.

### destination_crypto_address ###
#### (CryptoAddress, **required**)

The destination crypto address to which to send the cryptocurrency.

## Type ExecutionOrder ###

Name                | Type        |   |
------------------- | ----------- | - |
id                  | Id          | **required**
status              | String      | **required**
crypto_amount_sent  | MoneyAmount | **required** if `status == "completed"`
blockchain_txn_hash | Id          | **required** if `status == "completed"`

### id ###
#### (Id, **required**)

An opaque string generated by you and stored by Simplex.

You may use this identifier to notify Simplex of the status of the execution order once it changes, and Simplex may use this identifier to query you about the status of the execution order.

### status ###
#### (String, **required**)

One of { `"pending"`, `"completed"`, `"failed"` }.

### crypto_amount_sent ###
#### (MoneyAmount, **required** if `status == "completed"`)

The actual amount sent. Must match `crypto_amount` from the request unless `reason == "refund"`, in which case you may, under previous agreement with Simplex, subtract a reasonable amount for the blockchain transaction fee.

### blockchain_txn_hash ###
#### (Id, **required** if `status == "completed"`)

The blockchain transaction hash of the transaction created by you in order to fulfill the execution order.

## Response ##

> Example response:

```json
{
  "execution_order": {
    "id": "xo:7791528",
    "status": "completed",
    "crypto_amount_sent": 125000, // 0.125 BTC
    "blockchain_txn_hash": "f1eddb27fced47de0684f913714b43e589f23fbb9ef17ceaa9f75e290f1541af"
  }
}
```

Your response is an ExecutionOrder. If its status is `"pending"` you will need to later notify Simplex when the status changes. You do this using the `execution-order-notify-status` message.

Alternatively, Simplex may poll you for the status, via either p/REST or MsgQueue, using `execution-order-get-status`.

Name            | Type           |   |
--------------- | -------------- | - |
execution_order | ExecutionOrder | **required**

## p/REST ##

If you supply a p/REST endpoint for this API, Simplex will use  
<span class="http-verb http-post">POST</span> `https://${YOUR_API_URL}/send-crypto`

## MsgQueue ##

Alternatively, you may receive this request as a message of type `"send-crypto"` in  
<span class="http-verb http-get">GET</span> `https://api.simplexcc.com/v3/msg`

You respond by  
<span class="http-verb http-post">POST</span> `https://api.simplexcc.com/v3/msg/:msg-id/response`

You will need to also acknowledge receipt of the message, by  
<span class="http-verb http-post">POST</span> `https://api.simplexcc.com/v3/msg/:msg-id/ack`

[modeline]: # ( vim: set ts=2 sw=2 expandtab wrap linebreak: )
