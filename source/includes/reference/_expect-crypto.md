# expect-crypto #

A request from Simplex to you, asking that you run final checks before accepting cryptocurrency from an end-user.

This request from Simplex allows you to start monitoring the blockchain. Once you detect the blockchain transaction that transfers cryptocurrency to your destination crypto address you may wish to run your own checks on that blockchain transaction.

Your response includes an identifier for this "transaction check" process which Simplex can use to query you about its status.

The result of a transaction check can be:

`"accept"` : you received the cryptocurrency and all your checks passed. Simplex will continue to finalize the transaction.

`"reject"` : you received the cryptocurrency but wish to reject the transaction for reasons such as failed AML checks, amount does not match the quote agreed upon, etc. Simplex will proceed with a refund process, and you can expect a subsequent `send-crypto` request, specifying the crypto address to which you are to return the cryptocurrency (which may be different from the one it was sent from).

## Synopsis ##

API name: **`expect-crypto`**  
Direction: **Simplex &rarr; You**

## Parameters ##

> Example request:

```json
{
  "reason": "delivery",
  "txn_id": "af492cb2-5b07-4318-8ece-be34f479e23b",
  "user_id": "595b88bea687c5dd444f99e0004a45d3",
  "account_id": "39cb996a-6cc8-43b9-ad37-1102a958ff38",
  "quote_id": "bb4fbdef-9abc-41c1-94d9-a670413c4d02",
  "crypto_currency": "BTC",
  "crypto_amount": 125000, // 0.125 BTC
  "destination_crypto_address": "1EmXYy57z71H8J5jrxXsdjuJXZnPZgHnjh"
}
```

Name                       | Type           |   |
-------------------------- | -------------- | - |
reason                     | String         | **required**
txn_id                     | Id             | **required**
user_id                    | Id             | **required**
account_id                 | String         |
quote_id                   | Id             | **required**
crypto_currency            | CryptoCurrency | **required**
crypto_amount              | MoneyAmount    | **required**
destination_crypto_address | CryptoAddress  | **required**

### reason ###
#### (String, **required**)

The reason you are receiving cryptocurrency.

One of { `"delivery"`, `"refund"` }.

 * `"delivery"` : you are buying cryptocurrency: you are either the App (in a BuyCrypto transaction) or the Liquidity Receiver (in a SellCrypto transaction)
 * `"refund"` : the reverse of "delivery" -- we need to return, to the original sender, cryptocurrency that you previously received.

### txn_id ###
#### (Id, **required**)

The identifier of the Simplex transaction involved.

### user_id ###
#### (Id, **required**)

A unique identifier, crearted by Simplex, for the end-user performing the transaction.

Same `user_id` as a previous message means same end-user.

### account_id ###
#### (String, optional)

For wallets/exchanges: the end-user's account id on your system. This is what you sent Simplex in `initiate-sell`.

### quote_id ###
#### (Id, **required**)

The identifier of the quote on which this transactino is based.

### crypto_currency ###
#### (CryptoCurrency, **required**)

The crypto currency (the currency, not the amount) to expect to receive.

### crypto_amount ###
#### (MoneyAmount, **required**)

How much cryptocurrency of type `crypto_currency` to expect to receive.

### destination_crypto_address ###
#### (CryptoAddress, **required**)

The crypto address to which the cryptocurrency will be sent.

This is an address you previously supplied to Simplex in response to a `get-destination-crypto-address` message.

## Response ##

> Example response:

```json
{
  "txn_check_id": "txnchk:09163938",
  "status": "pending"
}
```

If you respond with a `"pending"` status, via either p/REST or MsgQueue, you will need to later notify Simplex when the status changes to either `"success"` or `"reject"`. You do this using the `expect-crypto-notify-status` message.

Alternatively, Simplex may poll you for the status, again via either p/REST or MsgQueue, using `expect-crypto-get-status`.

Name         | Type   |   |
------------ | ------ | - |
txn_check_id | Id     | **required**
status       | String | **required**
reason       | String |

### txn_check_id ###
#### (Id, **required**)

An opaque string generated by you and stored by Simplex.

You may use this identifier to notify Simplex of the status of the transaction check process once it changes (e.g. moves from `"pending"` to `"success"`), and Simplex may use this identifier to query you regarding the status of the transaction check.

### status ###
#### (String, **required**)

One of { `"pending"`, `"success"`, `"reject"` }.

### reason ###
#### (String, optional)

If you reply with a `"reject"` status, this is a short description of the reason.

## p/REST ##

If you supply a p/REST endpoint for this API, Simplex will use  
<span class="http-verb http-post">POST</span> `https://${YOUR_API_URL}/expect-crypto`

## MsgQueue ##

Alternatively, you may receive this request as a message of type `"expect-crypto"` in  
<span class="http-verb http-get">GET</span> `https://api.simplexcc.com/v1/msg`

You respond by  
<span class="http-verb http-post">POST</span> `https://api.simplexcc.com/v1/msg/:msg-id/response`

You will need to also acknowledge receipt of the message, by  
<span class="http-verb http-post">POST</span> `https://api.simplexcc.com/v1/msg/:msg-id/ack`

[modeline]: # ( vim: set ts=2 sw=2 expandtab wrap linebreak: )
