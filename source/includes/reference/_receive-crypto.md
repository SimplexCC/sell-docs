# check-crypto #

A request from Simplex to you, asking that you run your internal AML/regulatory/otherwise checks before accepting cryptocurrency from an end-user.

The cryptocurrency may or may not already be in the destination address; you should monitor the blockchain for transactions with the specified destination address (which, again, may have happened in the past as far as your code is concerned). Once you detect the blockchain transaction that transfers cryptocurrency to the specified destination crypto address you may wish to run your own checks on that blockchain transaction.

Your response includes an identifier for this "crypto check" process which Simplex can use to query you about its status.

The result of a wcrypto check can be:

`"accept"` : you received the cryptocurrency and all your checks passed. You are fine with keeping this cryptocurrency, subject to Simplex providing an approriate quote that was previously received from you.

`"reject"` : you received the cryptocurrency but cannot keep it due to it violating your AML or other regulatory policies. Simplex will proceed with a refund process, and you can expect a subsequent `send-crypto` request, specifying the crypto address to which you are to return the cryptocurrency (which may be different from the one it was sent from).

## Synopsis ##

API name: **`check-crypto`**  
Direction: **Simplex &rarr; You**

## Parameters ##

> Example request:

```json
{
  "reason": "delivery",
  "txn_id": "af492cb2-5b07-4318-8ece-be34f479e23b",
  "user_id": "595b88bea687c5dd444f99e0004a45d3",
  "user_aka_ids": ["1504241c7d83476aa3adcd54e2272d25", "38b583c7ccd246ffaed4ab0232b71647"],
  "crypto_currency": "BTC",
  "destination_crypto_address": "1EmXYy57z71H8J5jrxXsdjuJXZnPZgHnjh"
}
```

Name                       | Type           |   |
-------------------------- | -------------- | - |
reason                     | String         | **required**
txn_id                     | Id             | **required**
user_id                    | Id             | **required**
user_aka_ids               | List<Id>       | **required**
crypto_currency            | CryptoCurrency | **required**
destination_crypto_address | CryptoAddress  | **required**

### reason ###
#### (String, **required**)

The reason you are receiving cryptocurrency.

One of { `"delivery"`, `"refund"` }.

 * `"delivery"` : you are buying cryptocurrency: you are either the App (in a BuyCrypto transaction) or the Liquidity Receiver (in a SellCrypto transaction).
 * `"refund"` : the reverse of "delivery" -- we need to return to you, the original sender, cryptocurrency that you previously sent.

### txn_id ###
#### (Id, **required**)

The identifier of the Simplex transaction involved.

### user_id ###
#### (Id, **required**)

A unique identifier, created by Simplex, for the end-user performing the transaction.

Same `user_id` as a previous message means same end-user.

### user_aka_ids ###
#### (List<Id>, **required**)

A list of unique identifiers, on top of `user_id`, by which the user is also known.

### crypto_currency ###
#### (CryptoCurrency, **required**)

The crypto currency (the currency, not the amount) to expect to receive.

### destination_crypto_address ###
#### (CryptoAddress, **required**)

The crypto address to which the cryptocurrency will be sent.

This is an address you previously supplied to Simplex in response to a `get-destination-crypto-address` message.

## Response ##

> Example response:

```json
{
  "crypto_check_id": "da8f72d2-d1c6-4468-89da-37f6d87f0cdf",
  "status": "pending"
}
```

If you respond with a `"pending"` status, via either p/REST or MsgQueue, you will need to later notify Simplex when the status changes to either `"accept"` or `"reject"`. You do this using the `check-crypto-notify-status` message.

Alternatively, Simplex may poll you for the status, again via either p/REST or MsgQueue, using `check-crypto-get-status`.

Name            | Type   |   |
--------------- | ------ | - |
crypto_check_id | Id     | **required**
status          | String | **required**
reason          | String |

### crypto_check_id ###
#### (Id, **required**)

An opaque string generated by you and stored by Simplex.

You may use this identifier to notify Simplex of the status of the crypto-check process once it changes (e.g. moves from `"pending"` to `"accept"`), and Simplex may use this identifier to query you regarding the status of the crypto-check.

### status ###
#### (String, **required**)

One of { `"pending"`, `"accept"`, `"reject"` }.

### reason ###
#### (String, optional)

If you reply with a `"reject"` status, this is a short description of the reason.

## p/REST ##

If you supply a p/REST endpoint for this API, Simplex will use  
<span class="http-verb http-post">POST</span> `https://${YOUR_API_URL}/check-crypto`

## MsgQueue ##

Alternatively, you may receive this request as a message of type `"check-crypto"` in  
<span class="http-verb http-get">GET</span> `https://api.simplexcc.com/v1/msg`

You respond by  
<span class="http-verb http-post">POST</span> `https://api.simplexcc.com/v1/msg/:msg-id/response`

You will need to also acknowledge receipt of the message, by  
<span class="http-verb http-post">POST</span> `https://api.simplexcc.com/v1/msg/:msg-id/ack`

[modeline]: # ( vim: set ts=2 sw=2 expandtab wrap linebreak: )
